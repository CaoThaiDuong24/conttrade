# PHÃ‚N TÃCH QUY TRÃŒNH MUA VÃ€ BÃN CONTAINER

## ğŸ“‹ TÃ“M Táº®T QUY TRÃŒNH THEO TÃ€I LIá»†U

### **LUá»’NG CHÃNH (Main Flow)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QUY TRÃŒNH GIAO Dá»ŠCH CONTAINER                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SELLER SIDE                     PLATFORM                    BUYER SIDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ÄÄ‚NG TIN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Seller login â”‚
â”‚ Táº¡o listing  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload áº£nh   â”‚             â”‚ Admin kiá»ƒm duyá»‡tâ”‚
â”‚ Nháº­p giÃ¡     â”‚             â”‚ - Há»£p lá»‡: Duyá»‡t â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ - KhÃ´ng: Tá»« chá»‘iâ”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Listing APPROVEDâ”‚
                             â”‚ Hiá»‡n cÃ´ng khai  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


2. TÃŒM KIáº¾M & XEM LISTING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        â”‚ Buyer login  â”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ TÃ¬m kiáº¿m     â”‚
                             â”‚ Public Listings â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ Xem chi tiáº¿t â”‚
                             â”‚                 â”‚       â”‚ LÆ°u yÃªu thÃ­châ”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


3. THÆ¯Æ NG LÆ¯á»¢NG (VIA MESSAGING)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Seller       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Há»† THá»NG       â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ Buyer        â”‚
â”‚              â”‚             â”‚  NHáº®N TIN       â”‚       â”‚              â”‚
â”‚ Tráº£ lá»i      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Ná»˜I Bá»˜         â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ Há»i thÃ´ng tinâ”‚
â”‚ ThÆ°Æ¡ng lÆ°á»£ng â”‚             â”‚                 â”‚       â”‚ ThÆ°Æ¡ng lÆ°á»£ng â”‚
â”‚ giÃ¡          â”‚             â”‚ (Real-time chat)â”‚       â”‚ giÃ¡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ Thá»a thuáº­n:     â”‚
                             â”‚ - GiÃ¡ cuá»‘i cÃ¹ng â”‚
                             â”‚ - Äiá»u kiá»‡n giaoâ”‚
                             â”‚ - Dá»‹ch vá»¥ Ä‘i kÃ¨mâ”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


4. GIÃM Äá»ŠNH Táº I DEPOT (TÃ™Y CHá»ŒN - PHYGITAL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        â”‚ Buyer yÃªu cáº§uâ”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ giÃ¡m Ä‘á»‹nh    â”‚
                             â”‚ Depot Staff     â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ qua ná»n táº£ng â”‚
                             â”‚                 â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ 1. Kiá»ƒm tra theoâ”‚
                             â”‚    tiÃªu chuáº©n   â”‚
                             â”‚    (IICL-6...)  â”‚
                             â”‚                 â”‚
                             â”‚ 2. Táº¡o bÃ¡o cÃ¡o  â”‚
                             â”‚    + áº£nh/video  â”‚
                             â”‚                 â”‚
                             â”‚ 3. Upload lÃªn   â”‚
                             â”‚    ná»n táº£ng     â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚ BÃ¡o cÃ¡o giÃ¡m    â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ Buyer xem    â”‚
                             â”‚ Ä‘á»‹nh gáº¯n vÃ o    â”‚       â”‚ bÃ¡o cÃ¡o      â”‚
                             â”‚ listing         â”‚       â”‚              â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ Quyáº¿t Ä‘á»‹nh:  â”‚
                                                        â”‚ - Tiáº¿p tá»¥c   â”‚
                                                        â”‚ - YÃªu cáº§u sá»­aâ”‚
                                                        â”‚ - Há»§y        â”‚
                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


5. Táº O ÄÆ¡N HÃ€NG & THANH TOÃN ESCROW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        â”‚ Buyer chá»n   â”‚
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ "Tiáº¿n hÃ nh   â”‚
                             â”‚ Táº¡o ORDER tá»«    â”‚â—„â”€â”€â”€â”€â”€â”€â”‚  thanh toÃ¡n" â”‚
                             â”‚ LISTING         â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                 â”‚              â”‚
                             â”‚ Status:         â”‚              â–¼
                             â”‚ pending_payment â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ Chuyá»ƒn tiá»n  â”‚
                                      â”‚                â”‚ vÃ o ESCROW   â”‚
                                      â”‚                â”‚ (tÃ i khoáº£n   â”‚
                                      â”‚                â”‚  kÃ½ quá»¹)     â”‚
                                      â–¼                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
                             â”‚ XÃ¡c nháº­n nháº­n   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ tiá»n ESCROW     â”‚
                             â”‚                 â”‚
                             â”‚ Status:         â”‚
                             â”‚ escrow_funded   â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Seller nháº­n  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ ThÃ´ng bÃ¡o cho   â”‚
â”‚ thÃ´ng bÃ¡o    â”‚             â”‚ Seller báº¯t Ä‘áº§u  â”‚
â”‚ chuáº©n bá»‹ giaoâ”‚             â”‚ giao hÃ ng       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


6. GIAO NHáº¬N CONTAINER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Seller       â”‚             â”‚                 â”‚       â”‚ Buyer        â”‚
â”‚              â”‚             â”‚                 â”‚       â”‚              â”‚
â”‚ Sáº¯p xáº¿p giao â”‚             â”‚                 â”‚       â”‚ Nháº­n containerâ”‚
â”‚ container Ä‘áº¿nâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚       â”‚ táº¡i Ä‘á»‹a chá»‰  â”‚
â”‚ Ä‘á»‹a chá»‰      â”‚             â”‚                 â”‚       â”‚ hoáº·c Depot   â”‚
â”‚              â”‚             â”‚                 â”‚       â”‚              â”‚
â”‚              â”‚             â”‚                 â”‚       â”‚ Kiá»ƒm tra     â”‚
â”‚              â”‚             â”‚                 â”‚       â”‚ thá»±c táº¿      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                 â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                 â”‚              â”‚
                             â”‚                 â”‚              â–¼
                             â”‚                 â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚                 â”‚       â”‚ Buyer xÃ¡c    â”‚
                             â”‚  ORDER          â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ nháº­n "ÄÃ£ nháº­nâ”‚
                             â”‚  Status:        â”‚       â”‚ hÃ ng"        â”‚
                             â”‚  completed      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                 â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼

7. GIáº¢I NGÃ‚N Tá»ª ESCROW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Seller nháº­n  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Tá»± Ä‘á»™ng giáº£i    â”‚
â”‚ tiá»n vÃ o     â”‚             â”‚ ngÃ¢n tá»« ESCROW  â”‚
â”‚ tÃ i khoáº£n    â”‚             â”‚ - Trá»« phÃ­ sÃ n   â”‚
â”‚              â”‚             â”‚ - Chuyá»ƒn cho    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   Seller        â”‚
                             â”‚                 â”‚
                             â”‚ PAYMENT         â”‚
                             â”‚ Status: releasedâ”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


8. ÄÃNH GIÃ SAU GIAO Dá»ŠCH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Seller       â”‚             â”‚ Há»‡ thá»‘ng má»i    â”‚       â”‚ Buyer        â”‚
â”‚              â”‚             â”‚ Ä‘Ã¡nh giÃ¡        â”‚       â”‚              â”‚
â”‚ ÄÃ¡nh giÃ¡    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”œâ”€â”€â”€â”€â”€â”€â–ºâ”‚ ÄÃ¡nh giÃ¡     â”‚
â”‚ Buyer        â”‚             â”‚                 â”‚       â”‚ Seller       â”‚
â”‚ (â­ + review)â”‚             â”‚ LÆ°u vÃ o profile â”‚       â”‚ (â­ + review) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ¯ **CÃC API Cáº¦N THIáº¾T (ÄÃšNG THEO QUY TRÃŒNH)**

### **1. LISTINGS APIs** âœ… (ÄÃ£ cÃ³)
```
POST   /api/v1/listings          - Seller táº¡o listing
GET    /api/v1/listings          - Public search/browse
GET    /api/v1/listings/:id      - Xem chi tiáº¿t
PATCH  /api/v1/listings/:id      - Seller chá»‰nh sá»­a
DELETE /api/v1/listings/:id      - Seller xÃ³a
GET    /api/v1/my-listings       - Seller quáº£n lÃ½ listings cá»§a mÃ¬nh
```

### **2. MESSAGING APIs** âŒ (CHÆ¯A CÃ“ - Cáº¦N Táº O)
```
POST   /api/v1/messages                    - Gá»­i tin nháº¯n
GET    /api/v1/messages/conversations      - Danh sÃ¡ch cuá»™c há»™i thoáº¡i
GET    /api/v1/messages/conversations/:id  - Chi tiáº¿t cuá»™c há»™i thoáº¡i
PATCH  /api/v1/messages/:id/read           - ÄÃ¡nh dáº¥u Ä‘Ã£ Ä‘á»c
```

**Purpose:** Buyer vÃ  Seller thÆ°Æ¡ng lÆ°á»£ng trá»±c tiáº¿p vá» giÃ¡ vÃ  Ä‘iá»u kiá»‡n

### **3. DEPOT INSPECTION APIs** âŒ (CHÆ¯A CÃ“ - Cáº¦N Táº O)
```
POST   /api/v1/inspections                 - Buyer yÃªu cáº§u giÃ¡m Ä‘á»‹nh
GET    /api/v1/inspections/:id             - Xem bÃ¡o cÃ¡o giÃ¡m Ä‘á»‹nh
PATCH  /api/v1/inspections/:id             - Depot staff cáº­p nháº­t bÃ¡o cÃ¡o
GET    /api/v1/listings/:id/inspections    - Láº¥y cÃ¡c bÃ¡o cÃ¡o giÃ¡m Ä‘á»‹nh cá»§a listing
```

**Purpose:** TÃ­ch há»£p dá»‹ch vá»¥ Phygital - giÃ¡m Ä‘á»‹nh cháº¥t lÆ°á»£ng táº¡i Depot

### **4. ORDERS APIs (DIRECT FROM LISTING)** âš ï¸ (Cáº¦N Sá»¬A)
```
POST   /api/v1/orders                      - Táº¡o order TRá»°C TIáº¾P tá»« listing
GET    /api/v1/orders                      - Danh sÃ¡ch orders
GET    /api/v1/orders/:id                  - Chi tiáº¿t order
PATCH  /api/v1/orders/:id/status           - Cáº­p nháº­t tráº¡ng thÃ¡i
```

**Input khi táº¡o order:**
```json
{
  "listingId": "listing-id",
  "agreedPrice": 225000000,  // GiÃ¡ Ä‘Ã£ thÆ°Æ¡ng lÆ°á»£ng qua chat
  "deliveryAddress": {
    "street": "...",
    "city": "...",
    "province": "..."
  },
  "notes": "Ghi chÃº giao hÃ ng"
}
```

**KHÃ”NG Cáº¦N RFQ/QUOTE** - Táº¡o order trá»±c tiáº¿p sau khi thá»a thuáº­n qua chat

### **5. ESCROW PAYMENT APIs** âœ… (ÄÃ£ cÃ³ trong orders.ts)
```
POST   /api/v1/orders/:id/pay              - Thanh toÃ¡n vÃ o Escrow
POST   /api/v1/orders/:id/confirm-receipt  - Buyer xÃ¡c nháº­n Ä‘Ã£ nháº­n hÃ ng
                                             â†’ Tá»± Ä‘á»™ng giáº£i ngÃ¢n
POST   /api/v1/orders/:id/cancel           - Há»§y order, hoÃ n tiá»n Escrow
```

### **6. FAVORITES APIs** âŒ (CHÆ¯A CÃ“ - Cáº¦N Táº O)
```
POST   /api/v1/favorites                   - LÆ°u listing yÃªu thÃ­ch
GET    /api/v1/favorites                   - Danh sÃ¡ch yÃªu thÃ­ch
DELETE /api/v1/favorites/:listingId        - Bá» yÃªu thÃ­ch
```

### **7. REVIEWS APIs** âŒ (CHÆ¯A CÃ“ - Cáº¦N Táº O)
```
POST   /api/v1/reviews                     - Táº¡o Ä‘Ã¡nh giÃ¡ sau giao dá»‹ch
GET    /api/v1/reviews/user/:userId        - Xem Ä‘Ã¡nh giÃ¡ cá»§a user
GET    /api/v1/reviews/order/:orderId      - ÄÃ¡nh giÃ¡ cá»§a order cá»¥ thá»ƒ
```

### **8. DISPUTES APIs** âŒ (CHÆ¯A CÃ“ - Cáº¦N Táº O)
```
POST   /api/v1/disputes                    - Táº¡o tranh cháº¥p
GET    /api/v1/disputes/:id                - Chi tiáº¿t tranh cháº¥p
PATCH  /api/v1/disputes/:id/resolve        - Admin giáº£i quyáº¿t
```

### **9. DELIVERY/LOGISTICS APIs** âŒ (CHÆ¯A CÃ“ - TÆ¯Æ NG LAI)
```
POST   /api/v1/deliveries                  - YÃªu cáº§u váº­n chuyá»ƒn
GET    /api/v1/deliveries/:id/tracking     - Theo dÃµi GPS
PATCH  /api/v1/deliveries/:id/status       - Cáº­p nháº­t tráº¡ng thÃ¡i giao hÃ ng
```

---

## ğŸš¨ **Váº¤N Äá»€ Vá»šI IMPLEMENTATION HIá»†N Táº I**

### âŒ **SAI: RFQ/Quote Flow**
TÃ´i Ä‘Ã£ implement:
```
Buyer â†’ Create RFQ â†’ Seller Create Quote â†’ Buyer Accept Quote â†’ Create Order
```

### âœ… **ÄÃšNG: Direct Purchase Flow**
Theo tÃ i liá»‡u:
```
Buyer â†’ Browse Listings â†’ Chat vá»›i Seller â†’ Thá»a thuáº­n giÃ¡ 
      â†’ Create Order trá»±c tiáº¿p â†’ Pay Escrow â†’ Delivery â†’ Complete
```

---

## ğŸ“Š **DATABASE SCHEMA Cáº¦N Bá»” SUNG**

### **1. Message Model**
```prisma
model Conversation {
  id              String    @id @default(cuid())
  listingId       String
  listing         Listing   @relation(fields: [listingId], references: [id])
  buyerId         String
  buyer           User      @relation("BuyerConversations", fields: [buyerId], references: [id])
  sellerId        String
  seller          User      @relation("SellerConversations", fields: [sellerId], references: [id])
  messages        Message[]
  lastMessageAt   DateTime  @default(now())
  createdAt       DateTime  @default(now())
  
  @@unique([listingId, buyerId, sellerId])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  senderId       String
  sender         User         @relation(fields: [senderId], references: [id])
  content        String       @db.Text
  isRead         Boolean      @default(false)
  createdAt      DateTime     @default(now())
}
```

### **2. Inspection Model**
```prisma
model Inspection {
  id              String   @id @default(cuid())
  listingId       String
  listing         Listing  @relation(fields: [listingId], references: [id])
  requestedById   String
  requestedBy     User     @relation("InspectionRequests", fields: [requestedById], references: [id])
  depotStaffId    String?
  depotStaff      User?    @relation("InspectionAssignments", fields: [depotStaffId], references: [id])
  status          InspectionStatus @default(requested)
  standard        String   // "IICL-6", "CW", "WWT"
  findings        Json?    // Chi tiáº¿t phÃ¡t hiá»‡n
  report          Json?    // BÃ¡o cÃ¡o Ä‘áº§y Ä‘á»§
  photos          String[] // URLs áº£nh
  videos          String[] // URLs video
  requestedAt     DateTime @default(now())
  completedAt     DateTime?
}

enum InspectionStatus {
  requested
  assigned
  in_progress
  completed
  cancelled
}
```

### **3. Favorite Model**
```prisma
model Favorite {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  listingId  String
  listing    Listing  @relation(fields: [listingId], references: [id])
  createdAt  DateTime @default(now())
  
  @@unique([userId, listingId])
}
```

### **4. Review Model**
```prisma
model Review {
  id          String   @id @default(cuid())
  orderId     String   @unique
  order       Order    @relation(fields: [orderId], references: [id])
  reviewerId  String
  reviewer    User     @relation("ReviewsGiven", fields: [reviewerId], references: [id])
  revieweeId  String
  reviewee    User     @relation("ReviewsReceived", fields: [revieweeId], references: [id])
  rating      Int      // 1-5 stars
  comment     String?  @db.Text
  createdAt   DateTime @default(now())
}
```

### **5. Dispute Model**
```prisma
model Dispute {
  id              String        @id @default(cuid())
  orderId         String        @unique
  order           Order         @relation(fields: [orderId], references: [id])
  raisedById      String
  raisedBy        User          @relation("DisputesRaised", fields: [raisedById], references: [id])
  reason          String        @db.Text
  evidence        Json          // áº¢nh, video, mÃ´ táº£
  status          DisputeStatus @default(open)
  adminId         String?
  admin           User?         @relation("DisputesHandled", fields: [adminId], references: [id])
  resolution      String?       @db.Text
  resolvedAt      DateTime?
  createdAt       DateTime      @default(now())
}

enum DisputeStatus {
  open
  investigating
  resolved
  rejected
}
```

### **6. Sá»­a Order Model (Bá» RFQ/Quote)**
```prisma
model Order {
  id              String        @id @default(cuid())
  orderNumber     String        @unique
  
  // DIRECT FROM LISTING (khÃ´ng cáº§n RFQ/Quote)
  listingId       String
  listing         Listing       @relation(fields: [listingId], references: [id])
  
  buyerId         String
  buyer           User          @relation("BuyerOrders", fields: [buyerId], references: [id])
  sellerId        String
  seller          User          @relation("SellerOrders", fields: [sellerId], references: [id])
  
  // GiÃ¡ Ä‘Ã£ thá»a thuáº­n qua chat
  agreedPrice     Decimal       @db.Decimal(15, 2)
  currency        String        @default("VND")
  
  // ThÃ´ng tin giao hÃ ng
  deliveryAddress Json
  notes           String?       @db.Text
  
  status          OrderStatus   @default(pending_payment)
  
  payments        Payment[]
  review          Review?
  dispute         Dispute?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}
```

---

## ğŸ”„ **LUá»’NG Dá»® LIá»†U CHÃNH XÃC**

### **Buyer Journey:**
```
1. Browse Listings (GET /api/v1/listings)
2. View Detail (GET /api/v1/listings/:id)
3. Save Favorite (POST /api/v1/favorites) - optional
4. Chat with Seller (POST /api/v1/messages)
5. Request Inspection (POST /api/v1/inspections) - optional
6. Create Order (POST /api/v1/orders) vá»›i agreedPrice tá»« chat
7. Pay Escrow (POST /api/v1/orders/:id/pay)
8. Receive Container
9. Confirm Receipt (POST /api/v1/orders/:id/confirm-receipt)
10. Leave Review (POST /api/v1/reviews)
```

### **Seller Journey:**
```
1. Create Listing (POST /api/v1/listings)
2. Wait for Admin Approval
3. Receive Chat from Buyers (GET /api/v1/messages/conversations)
4. Negotiate Price via Chat (POST /api/v1/messages)
5. Receive Order Notification
6. Arrange Delivery
7. Wait for Buyer Confirmation
8. Receive Payment from Escrow
9. Leave Review (POST /api/v1/reviews)
```

---

## âœ… **Káº¾ HOáº CH CHá»ˆNH Sá»¬A**

### **Phase 1: XÃ³a RFQ/Quote (SAI)**
- [ ] XÃ³a `backend/src/routes/rfqs.ts`
- [ ] XÃ³a `backend/src/routes/quotes.ts`
- [ ] XÃ³a test script `test-buyer-apis.mjs`
- [ ] Update documentation

### **Phase 2: Táº¡o Messaging System (QUAN TRá»ŒNG NHáº¤T)**
- [ ] Create schema: Conversation, Message
- [ ] Create `backend/src/routes/messages.ts`
- [ ] Implement real-time chat (WebSocket hoáº·c polling)
- [ ] Frontend: Chat UI component

### **Phase 3: Direct Order Creation**
- [ ] Sá»­a `backend/src/routes/orders.ts`
  - Bá» logic táº¡o tá»« Quote
  - Táº¡o trá»±c tiáº¿p tá»« Listing + agreedPrice
- [ ] Update Order schema (bá» quoteId, thÃªm listingId)

### **Phase 4: Inspection System**
- [ ] Create schema: Inspection
- [ ] Create `backend/src/routes/inspections.ts`
- [ ] Depot staff workflow

### **Phase 5: Support Features**
- [ ] Favorites API
- [ ] Reviews API
- [ ] Disputes API

---

## ğŸ¯ **Káº¾T LUáº¬N**

**QUY TRÃŒNH ÄÃšNG:**
```
Listing â†’ Chat/Negotiate â†’ Inspection (optional) â†’ Direct Order â†’ Escrow â†’ Delivery â†’ Review
```

**KHÃ”NG PHáº¢I:**
```
RFQ â†’ Quote â†’ Order âŒ
```

RFQ/Quote flow phÃ¹ há»£p vá»›i B2B procurement, KHÃ”NG PHáº¢I marketplace C2C/B2C nhÆ° tÃ i liá»‡u mÃ´ táº£.
