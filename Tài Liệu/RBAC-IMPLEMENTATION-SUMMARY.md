# ğŸ” Há»† THá»NG RBAC HOÃ€N CHá»ˆNH - i-ContExchange

## ğŸ“‹ **Tá»”NG QUAN TRIá»‚N KHAI**

### âœ… **ÄÃ£ hoÃ n thÃ nh:**
1. **Navigation Service Ä‘á»™ng** - Menu thay Ä‘á»•i theo vai trÃ² vÃ  quyá»n
2. **6 vai trÃ² ngÆ°á»i dÃ¹ng** vá»›i phÃ¢n quyá»n chi tiáº¿t
3. **Test Panel** Ä‘á»ƒ chuyá»ƒn Ä‘á»•i vai trÃ² dá»… dÃ ng
4. **Middleware báº£o vá»‡ route** vá»›i kiá»ƒm tra quyá»n
5. **Component phÃ¢n quyá»n** cho dashboard

---

## ğŸ‘¥ **VAI TRÃ’ & QUYá»€N Háº N**

### **ğŸ”´ Admin (Quáº£n trá»‹ viÃªn)**
**Navigation Menu:**
- ğŸ“Š Dashboard
- âš™ï¸ Quáº£n trá»‹
  - ğŸ“Š Tá»•ng quan (/admin)
  - ğŸ‘¥ NgÆ°á»i dÃ¹ng (/admin/users)
  - ğŸ“¦ Tin Ä‘Äƒng (/admin/listings)
  - âš ï¸ Tranh cháº¥p (/admin/disputes)
  - âš™ï¸ Cáº¥u hÃ¬nh (/admin/config)
  - ğŸ“„ Máº«u thÃ´ng bÃ¡o (/admin/templates)
  - ğŸ›¡ï¸ Nháº­t kÃ½ (/admin/audit)
  - ğŸ“ˆ Thá»‘ng kÃª (/admin/analytics)
- ğŸ“¦ Container (/listings)
- ğŸ›’ ÄÆ¡n hÃ ng (/orders)
- ğŸ‘¥ NgÆ°á»i dÃ¹ng (/admin/users)
- ğŸ†˜ Há»— trá»£ (/help, /legal)

**Quyá»n:**
- ToÃ n quyá»n truy cáº­p táº¥t cáº£ chá»©c nÄƒng
- Quáº£n lÃ½ ngÆ°á»i dÃ¹ng, phÃ¢n quyá»n
- Kiá»ƒm duyá»‡t tin Ä‘Äƒng vÃ  tranh cháº¥p
- Cáº¥u hÃ¬nh há»‡ thá»‘ng vÃ  giÃ¡ cáº£
- Xem bÃ¡o cÃ¡o vÃ  thá»‘ng kÃª

---

### **ğŸ”µ Buyer (NgÆ°á»i mua)**
**Navigation Menu:**
- ğŸ“Š Dashboard
- ğŸ“¦ Container
  - ğŸ“¦ Táº¥t cáº£ container (/listings)
  - â­ ÄÃ£ lÆ°u (/listings/saved)
  - ğŸ‘ï¸ ÄÃ£ xem (/listings/viewed)
- ğŸ“„ RFQ
  - â• Táº¡o RFQ má»›i (/rfq/create)
  - ğŸ“¤ RFQ Ä‘Ã£ gá»­i (/rfq/sent)
  - ğŸ“¥ BÃ¡o giÃ¡ nháº­n (/rfq/received)
  - ğŸ”€ So sÃ¡nh bÃ¡o giÃ¡ (/rfq/compare)
- ğŸ›’ ÄÆ¡n hÃ ng
  - ğŸ“‹ Táº¥t cáº£ Ä‘Æ¡n hÃ ng (/orders)
  - ğŸ’³ Thanh toÃ¡n (/orders/checkout)
  - ğŸšš Theo dÃµi (/orders/tracking)
  - ğŸ“‹ Lá»‹ch sá»­ (/orders/history)
- ğŸ’° Thanh toÃ¡n
  - ğŸ›¡ï¸ VÃ­ escrow (/payments/escrow)
  - ğŸ“‹ Lá»‹ch sá»­ (/payments/history)
  - ğŸ’³ PhÆ°Æ¡ng thá»©c (/payments/methods)
- ğŸ” GiÃ¡m Ä‘á»‹nh (/inspection/new)
- ğŸšš Váº­n chuyá»ƒn (/delivery)
- â­ ÄÃ¡nh giÃ¡ (/reviews)
- âš ï¸ Khiáº¿u náº¡i (/disputes)
- ğŸ†˜ Há»— trá»£ (/help, /legal)

**Quyá»n:**
- Xem vÃ  tÃ¬m kiáº¿m container
- Táº¡o RFQ vÃ  quáº£n lÃ½ bÃ¡o giÃ¡
- Äáº·t hÃ ng vÃ  thanh toÃ¡n
- YÃªu cáº§u giÃ¡m Ä‘á»‹nh
- Theo dÃµi váº­n chuyá»ƒn
- ÄÃ¡nh giÃ¡ vÃ  khiáº¿u náº¡i

---

### **ğŸŸ¢ Seller (NgÆ°á»i bÃ¡n)**
**Navigation Menu:**
- ğŸ“Š Dashboard
- ğŸ“¦ Container (/listings)
- ğŸª BÃ¡n hÃ ng
  - â• ÄÄƒng tin má»›i (/sell/new)
  - ğŸ“‹ Tin Ä‘Äƒng cá»§a tÃ´i (/sell/my-listings)
  - âœï¸ NhÃ¡p (/sell/draft)
  - ğŸ“ˆ Thá»‘ng kÃª (/sell/analytics)
- ğŸ“„ RFQ & BÃ¡o giÃ¡
  - ğŸ“¥ RFQ nháº­n Ä‘Æ°á»£c (/rfq)
  - â• Táº¡o bÃ¡o giÃ¡ (/quotes/create)
  - ğŸ“‹ Quáº£n lÃ½ bÃ¡o giÃ¡ (/quotes/management)
- ğŸ›’ ÄÆ¡n hÃ ng (/orders)
- ğŸšš Váº­n chuyá»ƒn (/delivery)
- â­ ÄÃ¡nh giÃ¡ (/reviews)
- ğŸ§¾ HÃ³a Ä‘Æ¡n (/billing)
- ğŸ†˜ Há»— trá»£ (/help, /legal)

**Quyá»n:**
- ÄÄƒng tin bÃ¡n container
- Nháº­n vÃ  tráº£ lá»i RFQ
- Quáº£n lÃ½ Ä‘Æ¡n hÃ ng bÃ¡n
- Theo dÃµi váº­n chuyá»ƒn
- Quáº£n lÃ½ hÃ³a Ä‘Æ¡n

---

### **ğŸŸ¡ Depot Staff (NhÃ¢n viÃªn kho)**
**Navigation Menu:**
- ğŸ“Š Dashboard
- ğŸ­ Kho bÃ£i
  - ğŸ“¦ Tá»“n kho (/depot/stock)
  - â†”ï¸ Di chuyá»ƒn (/depot/movements)
  - ğŸšš Chuyá»ƒn kho (/depot/transfers)
  - âœï¸ Äiá»u chá»‰nh (/depot/adjustments)
- ğŸ” GiÃ¡m Ä‘á»‹nh
  - ğŸ“… Lá»‹ch giÃ¡m Ä‘á»‹nh (/depot/inspections)
  - ğŸ“„ BÃ¡o cÃ¡o (/inspection/reports)
  - âœ… TiÃªu chuáº©n (/inspection/quality)
- ğŸ”§ Sá»­a chá»¯a (/depot/repairs)
- ğŸšš Váº­n chuyá»ƒn (/delivery)
- ğŸ†˜ Há»— trá»£ (/help, /legal)

**Quyá»n:**
- Quáº£n lÃ½ tá»“n kho depot
- Xá»­ lÃ½ nháº­p-xuáº¥t-chuyá»ƒn kho
- Thá»±c hiá»‡n giÃ¡m Ä‘á»‹nh
- BÃ¡o cÃ¡o sá»­a chá»¯a

---

### **ğŸŸ£ Depot Manager (Quáº£n lÃ½ kho)**
**Navigation Menu:**
- ğŸ“Š Dashboard
- ğŸ­ Kho bÃ£i (táº¥t cáº£ chá»©c nÄƒng Depot Staff + quáº£n lÃ½)
- ğŸ” GiÃ¡m Ä‘á»‹nh (quáº£n lÃ½ vÃ  phÃª duyá»‡t)
- ğŸ›’ ÄÆ¡n hÃ ng (/orders)
- ğŸšš Váº­n chuyá»ƒn (/delivery)
- ğŸ§¾ HÃ³a Ä‘Æ¡n (/billing)
- â­ ÄÃ¡nh giÃ¡ (/reviews)
- ğŸ†˜ Há»— trá»£ (/help, /legal)

**Quyá»n:**
- Táº¥t cáº£ quyá»n cá»§a Depot Staff
- Äiá»u chá»‰nh vÃ  chuyá»ƒn kho
- PhÃª duyá»‡t giÃ¡m Ä‘á»‹nh
- Quáº£n lÃ½ Ä‘Æ¡n hÃ ng depot

---

### **ğŸ”µ Inspector (GiÃ¡m Ä‘á»‹nh viÃªn)**
**Navigation Menu:**
- ğŸ“Š Dashboard
- ğŸ” GiÃ¡m Ä‘á»‹nh
  - ğŸ“… Lá»‹ch lÃ m viá»‡c (/depot/inspections)
  - ğŸ“„ Táº¡o bÃ¡o cÃ¡o (/inspection/reports)
  - âœ… TiÃªu chuáº©n (/inspection/quality)
  - ğŸ“‹ Lá»‹ch sá»­ (/inspection/history)
- ğŸ­ Kho bÃ£i (/depot)
- ğŸ†˜ Há»— trá»£ (/help, /legal)

**Quyá»n:**
- Thá»±c hiá»‡n giÃ¡m Ä‘á»‹nh
- Táº¡o bÃ¡o cÃ¡o giÃ¡m Ä‘á»‹nh
- Xem thÃ´ng tin kho bÃ£i

---

## ğŸ”§ **CÃ”NG Cá»¤ TEST VÃ€ PHÃT TRIá»‚N**

### **Role Test Panel**
- Hiá»ƒn thá»‹ trong mÃ´i trÆ°á»ng development
- Chuyá»ƒn Ä‘á»•i vai trÃ² dá»… dÃ ng
- Preview navigation menu theo tá»«ng role

### **Console Commands**
```javascript
// Chuyá»ƒn Ä‘á»•i vai trÃ² báº±ng console
switchTestRole('admin')      // Admin
switchTestRole('buyer')      // Buyer
switchTestRole('seller')     // Seller
switchTestRole('depot_staff') // Depot Staff
switchTestRole('depot_manager') // Depot Manager
switchTestRole('inspector')  // Inspector
```

---

## ğŸ“ **Cáº¤U TRÃšC CODE**

### **Navigation Service** (`lib/auth/navigation-service.ts`)
- Quáº£n lÃ½ menu Ä‘á»™ng theo role
- Check permissions cho tá»«ng item
- Há»— trá»£ sub-menus vÃ  groups

### **RBAC Service** (`lib/auth/rbac-service.ts`)
- Äá»‹nh nghÄ©a roles vÃ  permissions
- Permission checking logic
- Role hierarchy management

### **Middleware** (`middleware.ts`)
- Route protection
- JWT verification
- Permission-based access control

### **Components**
- `DashboardSidebar`: Navigation sidebar vá»›i RBAC
- `AuthWrapper`: Layout wrapper vá»›i auth checking
- `RoleTestPanel`: Development testing tool

---

## ğŸš€ **HÆ¯á»šNG DáºªN Sá»¬ Dá»¤NG**

### **1. Khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng**
```bash
npm run dev
```

### **2. Truy cáº­p Dashboard**
```
http://localhost:3000/vi/dashboard
```

### **3. Test cÃ¡c vai trÃ²**
- Sá»­ dá»¥ng Role Test Panel trong sidebar
- Hoáº·c dÃ¹ng console commands
- Menu sáº½ thay Ä‘á»•i theo vai trÃ²

### **4. Kiá»ƒm tra permissions**
- Thá»­ truy cáº­p cÃ¡c route khÃ¡c nhau
- Middleware sáº½ block náº¿u khÃ´ng cÃ³ quyá»n
- Check navigation items theo role

---

## ğŸ“ˆ **TÃNH NÄ‚NG Ná»”I Báº¬T**

âœ… **Dynamic Navigation** - Menu thay Ä‘á»•i theo role vÃ  permissions  
âœ… **Route Protection** - Middleware báº£o vá»‡ má»i route  
âœ… **Permission-based UI** - Component hiá»ƒn thá»‹ theo quyá»n  
âœ… **Role Hierarchy** - PhÃ¢n cáº¥p quyá»n háº¡n rÃµ rÃ ng  
âœ… **Test Tools** - CÃ´ng cá»¥ test vai trÃ² trong development  
âœ… **TypeScript** - Type safety cho roles vÃ  permissions  
âœ… **Responsive** - Giao diá»‡n responsive trÃªn má»i device  

---

## ğŸ¯ **Káº¾T QUáº¢**

Há»‡ thá»‘ng RBAC Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai hoÃ n chá»‰nh vá»›i:
- **6 vai trÃ²** vá»›i navigation menu riÃªng biá»‡t
- **45+ permissions** phÃ¢n quyá»n chi tiáº¿t
- **Dynamic UI** thay Ä‘á»•i theo vai trÃ²
- **Security** báº£o vá»‡ route vÃ  component
- **Developer Experience** tá»‘t vá»›i test tools

NgÆ°á»i dÃ¹ng giá» cÃ³ tráº£i nghiá»‡m phÃ¹ há»£p vá»›i vai trÃ² cá»§a mÃ¬nh trong há»‡ thá»‘ng i-ContExchange!

---

**ğŸ”— Test ngay:** http://localhost:3000/vi/dashboard